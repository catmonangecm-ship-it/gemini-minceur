<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Coach Minceur - Le Secret du Poids</title>
    
    <!-- QuaggaJS pour le scanner de code-barres -->
    <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2@1.8.4/dist/quagga.min.js"></script>
    
    <!-- Firebase SDK - Version 9 compatible -->
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <style>
        /* ========================================
           DESIGN ULTRA MODERNE - STYLE GLASSMORPHISM
           ======================================== */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Effet de bulles d√©coratives en arri√®re-plan */
        body::before,
        body::after {
            content: '';
            position: fixed;
            border-radius: 50%;
            opacity: 0.1;
            z-index: 0;
        }

        body::before {
            width: 400px;
            height: 400px;
            background: white;
            top: -100px;
            left: -100px;
        }

        body::after {
            width: 600px;
            height: 600px;
            background: white;
            bottom: -200px;
            right: -200px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* ========================================
           HEADER AVEC GLASSMORPHISM
           ======================================== */
        .header {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 40px 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.18);
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-size: 2.5em;
            font-weight: 800;
            margin-bottom: 10px;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.2);
        }

        .header-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
            padding: 8px 20px;
            border-radius: 20px;
            margin-bottom: 15px;
            font-weight: 600;
            font-size: 0.9em;
            box-shadow: 0 4px 15px rgba(255, 107, 157, 0.4);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
            font-weight: 500;
        }

        /* ========================================
           GLASSMORPHISM CARDS
           ======================================== */
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.5);
            transition: transform 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-5px);
        }

        .glass-card h2 {
            color: #667eea;
            margin-bottom: 24px;
            font-size: 1.75em;
            font-weight: 700;
        }

        /* ========================================
           TABS MODERNE AVEC IC√îNES
           ======================================== */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .tab {
            flex: 1;
            min-width: 140px;
            padding: 15px 20px;
            background: transparent;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            color: #667eea;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ========================================
           FORMULAIRES MODERNES
           ======================================== */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #667eea;
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="password"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 15px;
            font-size: 15px;
            color: #333;
            background: white;
            transition: all 0.3s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        /* ========================================
           BOUTONS MODERNES GRADIENT
           ======================================== */
        .btn {
            padding: 14px 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn.success {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .btn.danger {
            background: linear-gradient(135deg, #ff4757 0%, #e84118 100%);
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4);
        }

        /* ========================================
           STATS CARDS GLASSMORPHISM
           ======================================== */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.25);
        }

        .stat-card .icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 2.5em;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-card .label {
            font-size: 14px;
            color: #666;
            font-weight: 600;
        }

        /* ========================================
           RESULT BOX MODERNE
           ======================================== */
        .result-box {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border: 2px solid rgba(102, 126, 234, 0.3);
            padding: 30px;
            border-radius: 20px;
            margin-top: 30px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
        }

        .result-box h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            font-weight: 700;
        }

        /* ========================================
           WEIGHT HISTORY
           ======================================== */
        .weight-item {
            background: rgba(102, 126, 234, 0.05);
            padding: 18px;
            border-radius: 15px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(102, 126, 234, 0.1);
            transition: all 0.3s ease;
        }

        .weight-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateX(5px);
        }

        /* ========================================
           GRAPHIQUE CANVAS
           ======================================== */
        #graphiquePoids {
            width: 100%;
            height: 300px;
            margin: 20px 0;
            border-radius: 15px;
            background: white;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        /* ========================================
           PLANNING HEBDOMADAIRE
           ======================================== */
        .planning-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .planning-day {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.1);
        }

        .day-header {
            font-weight: 800;
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #667eea;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .meal-slot {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            border: 2px dashed rgba(102, 126, 234, 0.3);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 12px;
            min-height: 80px;
            transition: all 0.3s;
        }

        .meal-slot:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            transform: scale(1.02);
        }

        .meal-slot.drag-over {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(69, 160, 73, 0.1) 100%);
            border-color: #4caf50;
            border-style: solid;
        }

        .meal-slot-title {
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .planned-meal {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            position: relative;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .delete-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .delete-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: rotate(90deg);
        }

        /* ========================================
           RECETTES CARDS
           ======================================== */
        .recipes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .recipe-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            cursor: grab;
            transition: all 0.3s ease;
            border: 2px solid rgba(102, 126, 234, 0.1);
        }

        .recipe-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .recipe-card:active {
            cursor: grabbing;
        }

        .recipe-image {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5em;
        }

        .recipe-content {
            padding: 20px;
        }

        .recipe-title {
            font-weight: 700;
            margin-bottom: 10px;
            color: #333;
            font-size: 1.1em;
        }

        .recipe-calories {
            display: inline-block;
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.9em;
            font-weight: 700;
        }

        /* ========================================
           NOTIFICATIONS MODERNES
           ======================================== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 18px 28px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 10000;
            min-width: 300px;
            border-left: 5px solid #667eea;
            font-weight: 600;
            animation: slideInRight 0.4s ease-out;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ========================================
           AUTHENTIFICATION GLASSMORPHISM
           ======================================== */
        #authModal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
            overflow-y: auto;
        }

        .auth-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 480px;
            width: 100%;
            padding: 48px 40px;
            animation: zoomIn 0.5s ease-out;
        }

        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .auth-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .auth-header h2 {
            color: #667eea;
            font-size: 2em;
            font-weight: 800;
            margin: 0 0 8px 0;
        }

        .auth-header p {
            color: #666;
            font-size: 1em;
            margin: 0;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 32px;
            background: rgba(102, 126, 234, 0.1);
            padding: 8px;
            border-radius: 15px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 700;
            color: #667eea;
            transition: all 0.3s ease;
        }

        .auth-tab:hover {
            background: rgba(102, 126, 234, 0.15);
        }

        .auth-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }

        .auth-input-group {
            margin-bottom: 20px;
        }

        .auth-input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: #667eea;
            font-size: 14px;
        }

        .auth-input-group input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            font-size: 15px;
            color: #333;
            background: white;
            transition: all 0.3s ease;
        }

        .auth-input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .auth-btn {
            width: 100%;
            padding: 16px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            margin-top: 8px;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .auth-error {
            background: #fee;
            border: 2px solid #fcc;
            color: #c33;
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
            animation: shake 0.5s;
        }

        .auth-error:not(:empty) {
            display: block;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .auth-success {
            background: #efe;
            border: 2px solid #cfc;
            color: #3c3;
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        .auth-success:not(:empty) {
            display: block;
        }

        /* ========================================
           PROGRESS BAR
           ======================================== */
        .progress-bar {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            overflow: hidden;
            height: 25px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            font-weight: 700;
            color: white;
            transition: width 0.5s ease;
            box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3);
        }

        /* ========================================
           RESPONSIVE MOBILE
           ======================================== */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 1.75em;
            }

            .glass-card {
                padding: 20px;
            }

            .tabs {
                justify-content: center;
            }

            .tab {
                font-size: 13px;
                padding: 12px 16px;
                min-width: 120px;
            }

            .stats {
                grid-template-columns: 1fr 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .auth-container {
                padding: 32px 24px;
                margin: 20px;
            }
        }

        /* ========================================
           ANIMATIONS SUPPL√âMENTAIRES
           ======================================== */
        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .float-animation {
            animation: float 3s ease-in-out infinite;
        }

        /* Badge utilisateur moderne */
        .user-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin-top: 15px;
        }

        .user-badge button {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            padding: 6px 12px;
            border-radius: 10px;
            cursor: pointer;
            color: white;
            font-weight: 600;
            transition: all 0.3s;
        }

        .user-badge button:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <!-- Modal de connexion/inscription -->
    <div id="authModal" style="display: none;">
        <div class="auth-container">
            <div class="auth-header">
                <div style="font-size: 4em; margin-bottom: 15px;" class="float-animation">üí™</div>
                <h2>Mon Coach Minceur</h2>
                <p>Rejoignez la communaut√© et transformez votre vie</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Connexion</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">Inscription</button>
            </div>

            <div id="authError" class="auth-error"></div>
            <div id="authSuccess" class="auth-success"></div>

            <!-- Formulaire de connexion -->
            <form id="loginForm" class="auth-form active" onsubmit="connexion(event)">
                <div class="auth-input-group">
                    <label>üìß Email</label>
                    <input type="email" id="loginEmail" placeholder="votre@email.com" required>
                </div>
                <div class="auth-input-group">
                    <label>üîí Mot de passe</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="auth-btn" id="loginBtn">
                    Se connecter
                </button>
            </form>

            <!-- Formulaire d'inscription -->
            <form id="registerForm" class="auth-form" onsubmit="inscription(event)">
                <div class="auth-input-group">
                    <label>üë§ Nom d'utilisateur</label>
                    <input type="text" id="registerName" placeholder="Votre nom" required>
                </div>
                <div class="auth-input-group">
                    <label>üìß Email</label>
                    <input type="email" id="registerEmail" placeholder="votre@email.com" required>
                </div>
                <div class="auth-input-group">
                    <label>üîí Mot de passe</label>
                    <input type="password" id="registerPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6" required>
                    <small style="color: #999; font-size: 0.85em;">Minimum 6 caract√®res</small>
                </div>
                <div class="auth-input-group">
                    <label>üîí Confirmer le mot de passe</label>
                    <input type="password" id="registerPasswordConfirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6" required>
                </div>
                <button type="submit" class="auth-btn" id="registerBtn">
                    Cr√©er mon compte
                </button>
            </form>

            <div style="text-align: center; margin-top: 30px; padding: 20px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border-radius: 15px;">
                <div style="font-size: 2em; margin-bottom: 10px;">üåç</div>
                <div style="color: #667eea; font-size: 0.95em; font-weight: 700;">Rejoignez la communaut√©</div>
                <div style="color: #764ba2; font-size: 0.85em; margin-top: 5px;">Des milliers d'utilisateurs vous attendent !</div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="header-badge">üí™ CALCUL EN LIGNE üî• ENTI√àREMENT GRATUIT üí™</div>
                <h1>üí™ Mon Coach Minceur üí™</h1>
                <div id="userBadgeContainer"></div>
                <p>üìò Suivez-nous sur Facebook</p>
            </div>
        </div>

        <div class="glass-card">
            <div class="tabs">
                <button class="tab active" onclick="showTab('profil')">
                    <span>üë§</span> Mon Profil
                </button>
                <button class="tab" onclick="showTab('suivi')">
                    <span>üìä</span> Mon Suivi
                </button>
                <button class="tab" onclick="showTab('calculateur')">
                    <span>üßÆ</span> Calculateur
                </button>
                <button class="tab" onclick="showTab('planning')">
                    <span>üìÖ</span> Planning
                </button>
                <button class="tab" onclick="showTab('conseils')">
                    <span>üí°</span> Conseils
                </button>
            </div>

            <!-- Onglet Profil -->
            <div id="profil" class="tab-content active">
                <h2>üë§ Cr√©ez votre profil personnalis√©</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nom / Pr√©nom</label>
                        <input type="text" id="nom" placeholder="Entrez votre nom">
                    </div>

                    <div class="form-group">
                        <label>Sexe</label>
                        <select id="sexe">
                            <option value="femme">Femme</option>
                            <option value="homme">Homme</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>√Çge (ann√©es)</label>
                        <input type="number" id="age" placeholder="25" min="10" max="100">
                    </div>

                    <div class="form-group">
                        <label>Taille (cm)</label>
                        <input type="number" id="taille" placeholder="170" min="100" max="250">
                    </div>

                    <div class="form-group">
                        <label>Poids actuel (kg)</label>
                        <input type="number" id="poids" placeholder="70" step="0.1" min="30" max="300">
                    </div>

                    <div class="form-group">
                        <label>Poids objectif (kg)</label>
                        <input type="number" id="objectif" placeholder="65" step="0.1" min="30" max="300">
                    </div>
                </div>

                <div class="form-group">
                    <label>Niveau d'activit√©</label>
                    <select id="activite">
                        <option value="1.2">S√©dentaire (peu ou pas d'exercice)</option>
                        <option value="1.375">L√©g√®rement actif (exercice 1-3 jours/semaine)</option>
                        <option value="1.55">Mod√©r√©ment actif (exercice 3-5 jours/semaine)</option>
                        <option value="1.725">Tr√®s actif (exercice 6-7 jours/semaine)</option>
                        <option value="1.9">Extr√™mement actif (exercice intense quotidien)</option>
                    </select>
                </div>

                <button class="btn" onclick="calculerProfil()">
                    <span>üöÄ</span> Calculer mon programme
                </button>

                <div id="resultatProfil" class="result-box" style="display: none;">
                    <h3>üéØ Votre bilan personnalis√©</h3>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="icon">üìä</div>
                            <div class="value" id="imcValue">-</div>
                            <div class="label">IMC</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon">üéØ</div>
                            <div class="value" id="poidsIdealValue">-</div>
                            <div class="label">Poids id√©al (kg)</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon">üí™</div>
                            <div class="value" id="aPerdrValue">-</div>
                            <div class="label">√Ä perdre (kg)</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon">üî•</div>
                            <div class="value" id="caloriesValue">-</div>
                            <div class="label">Calories/jour</div>
                        </div>
                    </div>
                    <div id="imcCategorie" style="margin-top: 20px; font-size: 1.15em; font-weight: 600; color: #667eea;"></div>
                    <div id="dureeProgramme" style="margin-top: 10px; font-weight: 600; color: #764ba2;"></div>
                </div>
            </div>

            <!-- Onglet Suivi -->
            <div id="suivi" class="tab-content">
                <h2>üìä Mon Suivi du Poids</h2>
                
                <div class="form-grid" style="align-items: end;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>üìÖ Date</label>
                        <input type="date" id="datePesee">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>‚öñÔ∏è Poids (kg)</label>
                        <input type="number" id="poidsPesee" step="0.1" placeholder="70.5">
                    </div>
                    <button class="btn success" onclick="ajouterPesee()" style="margin-bottom: 0;">
                        <span>‚ûï</span> Ajouter
                    </button>
                </div>

                <div id="progressionActuelle"></div>

                <canvas id="graphiquePoids" width="400" height="200"></canvas>

                <div style="margin-top: 30px;">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-weight: 700;">üìù Historique des pes√©es</h3>
                    <div id="listePesees"></div>
                </div>
            </div>

            <!-- Onglet Calculateur -->
            <div id="calculateur" class="tab-content">
                <h2>üßÆ Calculateur de Calories</h2>
                
                <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 25px; border-radius: 20px; margin-bottom: 25px; border: 2px solid rgba(102, 126, 234, 0.2);">
                    <p style="text-align: center; color: #667eea; font-size: 1.2em; font-weight: 600;">
                        üî¢ Calculez les calories de vos aliments facilement
                    </p>
                </div>

                <div style="background: white; border: 3px solid #667eea; border-radius: 20px; padding: 25px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-weight: 700;">üîç Rechercher un aliment</h3>
                    
                    <div class="form-group">
                        <label>Nom de l'aliment</label>
                        <input type="text" id="searchAliment" placeholder="Ex: poulet, pomme, riz..." oninput="rechercherAliment()">
                        <div id="suggestionsAliments" style="background: white; border: 2px solid #e0e0e0; border-radius: 12px; margin-top: 8px; max-height: 300px; overflow-y: auto; display: none;"></div>
                    </div>

                    <div class="form-group">
                        <label>Quantit√© (grammes)</label>
                        <input type="number" id="quantiteAliment" placeholder="100" min="1" step="1">
                    </div>

                    <button class="btn" onclick="ajouterAlimentCalcul()">
                        <span>‚ûï</span> Ajouter √† mon repas
                    </button>
                </div>

                <div id="repasActuel" style="display: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 20px; padding: 30px; margin-bottom: 25px; box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);">
                    <h3 style="margin-bottom: 20px; font-weight: 700;">üçΩÔ∏è Votre repas actuel</h3>
                    
                    <div id="listeAlimentsRepas" style="margin-bottom: 20px;"></div>

                    <div class="stats" style="margin-top: 20px;">
                        <div class="stat-card" style="background: rgba(255, 255, 255, 0.2);">
                            <div class="value" style="color: white; -webkit-text-fill-color: white;" id="totalCalories">0</div>
                            <div class="label" style="color: white;">Calories (kcal)</div>
                        </div>
                        <div class="stat-card" style="background: rgba(255, 255, 255, 0.2);">
                            <div class="value" style="color: white; -webkit-text-fill-color: white;" id="totalProteines">0</div>
                            <div class="label" style="color: white;">Prot√©ines (g)</div>
                        </div>
                        <div class="stat-card" style="background: rgba(255, 255, 255, 0.2);">
                            <div class="value" style="color: white; -webkit-text-fill-color: white;" id="totalGlucides">0</div>
                            <div class="label" style="color: white;">Glucides (g)</div>
                        </div>
                        <div class="stat-card" style="background: rgba(255, 255, 255, 0.2);">
                            <div class="value" style="color: white; -webkit-text-fill-color: white;" id="totalLipides">0</div>
                            <div class="label" style="color: white;">Lipides (g)</div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 25px; flex-wrap: wrap;">
                        <button class="btn success" onclick="sauvegarderRepas()" style="flex: 1; min-width: 200px;">
                            <span>üíæ</span> Sauvegarder
                        </button>
                        <button class="btn danger" onclick="reinitialiserRepas()" style="flex: 1; min-width: 200px;">
                            <span>üóëÔ∏è</span> Vider
                        </button>
                    </div>
                </div>

                <div style="margin-top: 30px;">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-weight: 700;">üìÖ Historique de mes repas</h3>
                    <div id="historiqueRepas"></div>
                </div>
            </div>

            <!-- Onglet Planning -->
            <div id="planning" class="tab-content">
                <h2>üìÖ Planning Hebdomadaire</h2>
                
                <div style="display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap;">
                    <button class="btn" onclick="afficherRecettesPlanning()">
                        <span>üç≥</span> Voir mes recettes
                    </button>
                    <button class="btn danger" onclick="viderPlanning()">
                        <span>üóëÔ∏è</span> Vider le planning
                    </button>
                </div>

                <div id="recettes-planning-container" style="display: none; margin-bottom: 30px;">
                    <h3 style="color: #667eea; margin-bottom: 20px; font-weight: 700;">üçΩÔ∏è Mes Recettes Disponibles</h3>
                    <div class="recipes-grid" id="recipes-planning"></div>
                </div>

                <div class="planning-grid" id="planning-container"></div>
            </div>

            <!-- Onglet Conseils -->
            <div id="conseils" class="tab-content">
                <h2>üí° Conseils Nutrition</h2>
                
                <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(69, 160, 73, 0.1) 100%); padding: 25px; border-radius: 20px; margin-bottom: 25px; border: 2px solid rgba(76, 175, 80, 0.3);">
                    <h3 style="color: #4caf50; margin-bottom: 15px; font-weight: 700;">ü•ó R√®gle n¬∞1 : L'√©quilibre alimentaire</h3>
                    <p style="color: #333; line-height: 1.6;">Privil√©giez une alimentation vari√©e et √©quilibr√©e. Chaque repas devrait contenir des prot√©ines, des glucides complexes, des l√©gumes et de bonnes graisses.</p>
                </div>

                <div style="background: linear-gradient(135deg, rgba(33, 150, 243, 0.1) 0%, rgba(30, 136, 229, 0.1) 100%); padding: 25px; border-radius: 20px; margin-bottom: 25px; border: 2px solid rgba(33, 150, 243, 0.3);">
                    <h3 style="color: #2196f3; margin-bottom: 15px; font-weight: 700;">üíß R√®gle n¬∞2 : L'hydratation</h3>
                    <p style="color: #333; line-height: 1.6;">Buvez au moins 1,5 √† 2 litres d'eau par jour. L'eau aide √† √©liminer les toxines et favorise la digestion.</p>
                </div>

                <div style="background: linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(251, 140, 0, 0.1) 100%); padding: 25px; border-radius: 20px; border: 2px solid rgba(255, 152, 0, 0.3);">
                    <h3 style="color: #ff9800; margin-bottom: 15px; font-weight: 700;">‚è∞ R√®gle n¬∞3 : Les horaires r√©guliers</h3>
                    <p style="color: #333; line-height: 1.6;">Mangez √† heures fixes pour r√©guler votre m√©tabolisme. Id√©alement : petit-d√©jeuner avant 9h, d√©jeuner entre 12h et 13h, d√Æner avant 20h.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==============================================
        // CONFIGURATION FIREBASE
        // ==============================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyAVsE39uVXpYQy_aehNS8f_bo94U-NWI28",
            authDomain: "moncoachminceurcatjer.firebaseapp.com",
            projectId: "moncoachminceurcatjer",
            storageBucket: "moncoachminceurcatjer.firebasestorage.app",
            messagingSenderId: "441403074242",
            appId: "1:441403074242:web:b38009005e7fa4e012bd5b"
        };

        let db = null;
        let auth = null;
        let firebaseInitialized = false;
        let currentUser = null;

        function initialiserFirebase() {
            if (typeof firebase === 'undefined') {
                setTimeout(initialiserFirebase, 100);
                return;
            }

            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                firebaseInitialized = true;
                
                console.log('‚úÖ Firebase initialis√©');
                
                auth.onAuthStateChanged(function(user) {
                    if (user) {
                        currentUser = user;
                        console.log('üë§ Utilisateur connect√©:', user.email);
                        
                        const modal = document.getElementById('authModal');
                        if (modal) modal.style.display = 'none';
                        
                        afficherBadgeUtilisateur();
                    } else {
                        currentUser = null;
                        const modal = document.getElementById('authModal');
                        if (modal) modal.style.display = 'flex';
                    }
                });

            } catch (error) {
                console.log('‚ö†Ô∏è Erreur Firebase:', error);
                firebaseInitialized = false;
            }
        }

        // ==============================================
        // AUTHENTIFICATION
        // ==============================================

        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelector('.auth-tab:first-child').classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelector('.auth-tab:last-child').classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
            
            hideAuthMessages();
        }

        function showAuthError(message) {
            const errorDiv = document.getElementById('authError');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
            }
        }

        function showAuthSuccess(message) {
            const successDiv = document.getElementById('authSuccess');
            if (successDiv) {
                successDiv.textContent = message;
                successDiv.style.display = 'block';
            }
        }

        function hideAuthMessages() {
            const errorDiv = document.getElementById('authError');
            const successDiv = document.getElementById('authSuccess');
            if (errorDiv) errorDiv.style.display = 'none';
            if (successDiv) successDiv.style.display = 'none';
        }

        async function inscription(event) {
            event.preventDefault();
            
            if (!firebaseInitialized || !auth) {
                showAuthError('Firebase non initialis√©');
                return;
            }
            
            hideAuthMessages();

            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;

            if (password !== passwordConfirm) {
                showAuthError('Les mots de passe ne correspondent pas');
                return;
            }

            const btn = document.getElementById('registerBtn');
            btn.disabled = true;
            btn.textContent = 'Cr√©ation en cours...';

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                
                await userCredential.user.updateProfile({
                    displayName: name
                });

                await db.collection('users').doc(userCredential.user.uid).set({
                    nom: name,
                    email: email,
                    dateInscription: firebase.firestore.FieldValue.serverTimestamp()
                });

                showAuthSuccess('‚úÖ Compte cr√©√© avec succ√®s !');
                
                setTimeout(() => {
                    const modal = document.getElementById('authModal');
                    if (modal) modal.style.display = 'none';
                    afficherNotification('üéâ Bienvenue ' + name + ' !');
                }, 1500);

            } catch (error) {
                console.error('Erreur inscription:', error);
                let message = 'Erreur lors de l\'inscription';
                
                if (error.code === 'auth/email-already-in-use') {
                    message = 'Cet email est d√©j√† utilis√©';
                } else if (error.code === 'auth/weak-password') {
                    message = 'Le mot de passe est trop faible';
                }
                
                showAuthError(message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Cr√©er mon compte';
            }
        }

        async function connexion(event) {
            event.preventDefault();
            
            if (!firebaseInitialized || !auth) {
                showAuthError('Firebase non initialis√©');
                return;
            }
            
            hideAuthMessages();

            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            const btn = document.getElementById('loginBtn');
            btn.disabled = true;
            btn.textContent = 'Connexion...';

            try {
                await auth.signInWithEmailAndPassword(email, password);
                showAuthSuccess('‚úÖ Connexion r√©ussie !');
                
                setTimeout(() => {
                    const modal = document.getElementById('authModal');
                    if (modal) modal.style.display = 'none';
                }, 1000);

            } catch (error) {
                console.error('Erreur connexion:', error);
                let message = 'Erreur lors de la connexion';
                
                if (error.code === 'auth/user-not-found') {
                    message = 'Aucun compte avec cet email';
                } else if (error.code === 'auth/wrong-password') {
                    message = 'Mot de passe incorrect';
                }
                
                showAuthError(message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Se connecter';
            }
        }

        async function deconnexion() {
            if (!confirm('Voulez-vous vraiment vous d√©connecter ?')) return;

            try {
                await auth.signOut();
                afficherNotification('üëã √Ä bient√¥t !');
                setTimeout(() => location.reload(), 1000);
            } catch (error) {
                console.error('Erreur d√©connexion:', error);
            }
        }

        function afficherBadgeUtilisateur() {
            const container = document.getElementById('userBadgeContainer');
            if (container && currentUser) {
                container.innerHTML = `
                    <div class="user-badge">
                        <span>üë§ ${currentUser.displayName || currentUser.email}</span>
                        <button onclick="deconnexion()">
                            üö™ D√©connexion
                        </button>
                    </div>
                `;
            }
        }

        // ==============================================
        // DONN√âES ET FONCTIONS
        // ==============================================

        let userData = JSON.parse(localStorage.getItem('userData')) || {};
        let pesees = JSON.parse(localStorage.getItem('pesees')) || [];
        let repasActuel = [];
        let repasSauvegardes = JSON.parse(localStorage.getItem('repas')) || [];
        let planningHebdo = JSON.parse(localStorage.getItem('planningHebdo')) || {};

        const baseAliments = [
            { nom: "Poulet", calories: 165, proteines: 31, glucides: 0, lipides: 3.6 },
            { nom: "Riz", calories: 130, proteines: 2.7, glucides: 28, lipides: 0.3 },
            { nom: "P√¢tes", calories: 131, proteines: 5, glucides: 25, lipides: 1.1 },
            { nom: "Pomme", calories: 52, proteines: 0.3, glucides: 14, lipides: 0.2 },
            { nom: "Banane", calories: 89, proteines: 1.1, glucides: 23, lipides: 0.3 },
            { nom: "Tomate", calories: 18, proteines: 0.9, glucides: 3.9, lipides: 0.2 },
            { nom: "Carotte", calories: 41, proteines: 0.9, glucides: 10, lipides: 0.2 },
            { nom: "Brocoli", calories: 34, proteines: 2.8, glucides: 7, lipides: 0.4 },
            { nom: "Saumon", calories: 208, proteines: 20, glucides: 0, lipides: 13 },
            { nom: "Thon", calories: 132, proteines: 28, glucides: 0, lipides: 1.3 },
            { nom: "Oeuf", calories: 155, proteines: 13, glucides: 1.1, lipides: 11 },
            { nom: "Yaourt", calories: 59, proteines: 10, glucides: 3.6, lipides: 0.4 }
        ];

        function afficherNotification(message, couleur = '#667eea') {
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.style.borderLeftColor = couleur;
            notif.textContent = message;
            document.body.appendChild(notif);

            setTimeout(() => {
                notif.style.opacity = '0';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }

        function calculerProfil() {
            const nom = document.getElementById('nom').value;
            const sexe = document.getElementById('sexe').value;
            const age = parseFloat(document.getElementById('age').value);
            const taille = parseFloat(document.getElementById('taille').value);
            const poids = parseFloat(document.getElementById('poids').value);
            const objectif = parseFloat(document.getElementById('objectif').value);
            const activite = parseFloat(document.getElementById('activite').value);

            if (!nom || !age || !taille || !poids || !objectif) {
                afficherNotification('‚ö†Ô∏è Veuillez remplir tous les champs', '#ff4757');
                return;
            }

            const imc = (poids / ((taille / 100) ** 2)).toFixed(1);
            
            let poidsIdeal;
            if (sexe === 'homme') {
                poidsIdeal = (taille - 100 - ((taille - 150) / 4)).toFixed(1);
            } else {
                poidsIdeal = (taille - 100 - ((taille - 150) / 2.5)).toFixed(1);
            }

            const aPerdre = Math.max(0, poids - objectif).toFixed(1);

            let bmr;
            if (sexe === 'homme') {
                bmr = 88.362 + (13.397 * poids) + (4.799 * taille) - (5.677 * age);
            } else {
                bmr = 447.593 + (9.247 * poids) + (3.098 * taille) - (4.330 * age);
            }
            const calories = Math.round((bmr * activite) - 500);

            let categorieIMC;
            if (imc < 18.5) {
                categorieIMC = "‚ö†Ô∏è Insuffisance pond√©rale";
            } else if (imc < 25) {
                categorieIMC = "‚úÖ Poids normal üéâ";
            } else if (imc < 30) {
                categorieIMC = "‚ö° Surpoids üí™";
            } else {
                categorieIMC = "üéØ Ob√©sit√© - Vous pouvez le faire ! üåü";
            }

            document.getElementById('imcValue').textContent = imc;
            document.getElementById('poidsIdealValue').textContent = poidsIdeal;
            document.getElementById('aPerdrValue').textContent = aPerdre;
            document.getElementById('caloriesValue').textContent = calories;
            document.getElementById('imcCategorie').innerHTML = `<strong>Cat√©gorie :</strong> ${categorieIMC}`;

            const semaines = Math.ceil(aPerdre / 0.5);
            document.getElementById('dureeProgramme').innerHTML = `<strong>‚è±Ô∏è Dur√©e estim√©e :</strong> ${semaines} semaines (perte recommand√©e : 0,5 kg/semaine)`;

            document.getElementById('resultatProfil').style.display = 'block';

            userData = { nom, sexe, age, taille, poids, objectif, activite, imc, poidsIdeal, calories };
            localStorage.setItem('userData', JSON.stringify(userData));

            afficherNotification('‚úÖ Profil cr√©√© avec succ√®s !', '#4caf50');
        }

        function ajouterPesee() {
            const date = document.getElementById('datePesee').value;
            const poids = parseFloat(document.getElementById('poidsPesee').value);

            if (!date || !poids) {
                afficherNotification('‚ö†Ô∏è Veuillez remplir tous les champs', '#ff4757');
                return;
            }

            pesees.push({ date, poids });
            pesees.sort((a, b) => new Date(a.date) - new Date(b.date));
            localStorage.setItem('pesees', JSON.stringify(pesees));

            afficherPesees();
            dessinerGraphique();

            document.getElementById('poidsPesee').value = '';
            afficherNotification('‚úÖ Pes√©e enregistr√©e !', '#4caf50');
        }

        function afficherPesees() {
            const liste = document.getElementById('listePesees');
            if (!liste) return;

            if (pesees.length === 0) {
                liste.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">üìä Aucune pes√©e enregistr√©e</p>';
                return;
            }

            liste.innerHTML = '';
            [...pesees].reverse().forEach((pesee, index) => {
                const realIndex = pesees.length - 1 - index;
                const div = document.createElement('div');
                div.className = 'weight-item';
                
                const dateFormatee = new Date(pesee.date + 'T00:00:00').toLocaleDateString('fr-FR');

                div.innerHTML = `
                    <span style="font-weight: 600;">üìÖ ${dateFormatee}</span>
                    <span style="font-weight: 700; color: #667eea;">${pesee.poids} kg</span>
                    <button class="btn danger" onclick="supprimerPesee(${realIndex})" style="padding: 8px 16px; font-size: 14px;">
                        üóëÔ∏è Supprimer
                    </button>
                `;
                liste.appendChild(div);
            });

            afficherProgression();
        }

        function afficherProgression() {
            const progressionDiv = document.getElementById('progressionActuelle');
            if (!progressionDiv) return;
            
            if (pesees.length === 0 || !userData.objectif) {
                progressionDiv.innerHTML = '';
                return;
            }

            const poidsActuel = pesees[pesees.length - 1].poids;
            const poidsDepart = pesees[0].poids;
            const objectif = userData.objectif;

            const totalAPerdre = poidsDepart - objectif;
            const dejaPerdu = poidsDepart - poidsActuel;
            const pourcentage = Math.min(100, Math.max(0, (dejaPerdu / totalAPerdre) * 100));

            progressionDiv.innerHTML = `
                <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(69, 160, 73, 0.1) 100%); padding: 25px; border-radius: 20px; margin: 25px 0; border: 2px solid rgba(76, 175, 80, 0.3);">
                    <h3 style="color: #4caf50; margin-bottom: 15px; font-weight: 700;">üìä Votre progression</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${pourcentage}%">${pourcentage.toFixed(1)}%</div>
                    </div>
                    <div style="color: #4caf50; margin-top: 15px; text-align: center; font-weight: 700; font-size: 1.1em;">
                        <strong>üéØ Perdu: ${dejaPerdu.toFixed(1)} kg</strong> sur ${totalAPerdre.toFixed(1)} kg
                    </div>
                </div>
            `;
        }

        function supprimerPesee(index) {
            if (confirm('Voulez-vous vraiment supprimer cette pes√©e ?')) {
                pesees.splice(index, 1);
                localStorage.setItem('pesees', JSON.stringify(pesees));
                afficherPesees();
                dessinerGraphique();
                afficherNotification('‚úÖ Pes√©e supprim√©e', '#ff4757');
            }
        }

        function dessinerGraphique() {
            const canvas = document.getElementById('graphiquePoids');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = 300;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (pesees.length === 0) {
                ctx.fillStyle = '#999';
                ctx.font = 'bold 18px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('üìä Aucune donn√©e disponible', canvas.width / 2, canvas.height / 2);
                return;
            }

            const padding = 50;
            const poids = pesees.map(p => p.poids);
            const minPoids = Math.min(...poids) - 2;
            const maxPoids = Math.max(...poids) + 2;

            // Grille de fond
            ctx.strokeStyle = '#f0f0f0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + (i / 5) * (canvas.height - 2 * padding);
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(canvas.width - padding, y);
                ctx.stroke();
            }

            // Dessiner la ligne de poids
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 4;
            ctx.beginPath();

            pesees.forEach((pesee, index) => {
                const x = padding + (index / (pesees.length - 1 || 1)) * (canvas.width - 2 * padding);
                const y = canvas.height - padding - ((pesee.poids - minPoids) / (maxPoids - minPoids)) * (canvas.height - 2 * padding);

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }

                // Points sur la courbe
                ctx.fillStyle = '#667eea';
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, 2 * Math.PI);
                ctx.fill();

                // Afficher le poids
                ctx.fillStyle = '#333';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(pesee.poids + ' kg', x, y - 15);
            });

            ctx.stroke();

            // Ligne d'objectif si d√©fini
            if (userData.objectif) {
                const objectifY = canvas.height - padding - ((userData.objectif - minPoids) / (maxPoids - minPoids)) * (canvas.height - 2 * padding);
                ctx.strokeStyle = '#4caf50';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(padding, objectifY);
                ctx.lineTo(canvas.width - padding, objectifY);
                ctx.stroke();
                ctx.setLineDash([]);

                ctx.fillStyle = '#4caf50';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'right';
                ctx.fillText('üéØ Objectif: ' + userData.objectif + ' kg', canvas.width - padding - 10, objectifY - 5);
            }
        }

        function rechercherAliment() {
            const recherche = document.getElementById('searchAliment').value.toLowerCase();
            const suggestions = document.getElementById('suggestionsAliments');

            if (recherche.length < 2) {
                suggestions.style.display = 'none';
                return;
            }

            const resultats = baseAliments.filter(aliment => 
                aliment.nom.toLowerCase().includes(recherche)
            );

            if (resultats.length === 0) {
                suggestions.style.display = 'none';
                return;
            }

            suggestions.innerHTML = resultats.map(aliment => `
                <div style="padding: 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: background 0.3s;" 
                     onclick="selectionnerAliment('${aliment.nom}')"
                     onmouseover="this.style.background='rgba(102, 126, 234, 0.05)'"
                     onmouseout="this.style.background='white'">
                    <div style="font-weight: 700; color: #667eea;">${aliment.nom}</div>
                    <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
                        üî• ${aliment.calories} kcal - üí™ ${aliment.proteines}g prot√©ines
                    </div>
                </div>
            `).join('');

            suggestions.style.display = 'block';
        }

        function selectionnerAliment(nom) {
            document.getElementById('searchAliment').value = nom;
            document.getElementById('suggestionsAliments').style.display = 'none';
            document.getElementById('quantiteAliment').focus();
        }

        function ajouterAlimentCalcul() {
            const nomAliment = document.getElementById('searchAliment').value.trim();
            const quantite = parseFloat(document.getElementById('quantiteAliment').value);

            if (!nomAliment || !quantite) {
                afficherNotification('‚ö†Ô∏è Veuillez remplir tous les champs', '#ff4757');
                return;
            }

            const aliment = baseAliments.find(a => a.nom.toLowerCase() === nomAliment.toLowerCase());
            
            if (!aliment) {
                afficherNotification('‚ö†Ô∏è Aliment non trouv√©', '#ff4757');
                return;
            }

            const facteur = quantite / 100;
            const alimentCalcule = {
                nom: aliment.nom,
                quantite: quantite,
                calories: aliment.calories * facteur,
                proteines: aliment.proteines * facteur,
                glucides: aliment.glucides * facteur,
                lipides: aliment.lipides * facteur
            };

            repasActuel.push(alimentCalcule);
            afficherRepasActuel();

            document.getElementById('searchAliment').value = '';
            document.getElementById('quantiteAliment').value = '';
            
            afficherNotification(`‚úÖ ${aliment.nom} ajout√©`, '#4caf50');
        }

        function afficherRepasActuel() {
            if (repasActuel.length === 0) {
                document.getElementById('repasActuel').style.display = 'none';
                return;
            }

            document.getElementById('repasActuel').style.display = 'block';

            const liste = document.getElementById('listeAlimentsRepas');
            liste.innerHTML = repasActuel.map((aliment, index) => `
                <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong style="font-size: 1.1em;">${aliment.nom} (${aliment.quantite}g)</strong><br>
                        <span style="font-size: 0.95em;">üî• ${Math.round(aliment.calories)} kcal</span>
                    </div>
                    <button onclick="retirerAliment(${index})" style="background: rgba(255,255,255,0.3); border: none; color: white; padding: 8px 15px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                        üóëÔ∏è
                    </button>
                </div>
            `).join('');

            const totaux = repasActuel.reduce((acc, aliment) => ({
                calories: acc.calories + aliment.calories,
                proteines: acc.proteines + aliment.proteines,
                glucides: acc.glucides + aliment.glucides,
                lipides: acc.lipides + aliment.lipides
            }), { calories: 0, proteines: 0, glucides: 0, lipides: 0 });

            document.getElementById('totalCalories').textContent = Math.round(totaux.calories);
            document.getElementById('totalProteines').textContent = Math.round(totaux.proteines * 10) / 10;
            document.getElementById('totalGlucides').textContent = Math.round(totaux.glucides * 10) / 10;
            document.getElementById('totalLipides').textContent = Math.round(totaux.lipides * 10) / 10;
        }

        function retirerAliment(index) {
            repasActuel.splice(index, 1);
            afficherRepasActuel();
            afficherNotification('‚úÖ Aliment retir√©', '#ff4757');
        }

        function reinitialiserRepas() {
            if (confirm('Vider ce repas ?')) {
                repasActuel = [];
                afficherRepasActuel();
                afficherNotification('‚úÖ Repas vid√©', '#ff4757');
            }
        }

        function sauvegarderRepas() {
            if (repasActuel.length === 0) {
                afficherNotification('‚ö†Ô∏è Ajoutez des aliments avant de sauvegarder', '#ff4757');
                return;
            }

            const nomRepas = prompt('Nom du repas :', '');
            if (!nomRepas) return;

            const totaux = repasActuel.reduce((acc, aliment) => ({
                calories: acc.calories + aliment.calories,
                proteines: acc.proteines + aliment.proteines,
                glucides: acc.glucides + aliment.glucides,
                lipides: acc.lipides + aliment.lipides
            }), { calories: 0, proteines: 0, glucides: 0, lipides: 0 });

            const repas = {
                id: Date.now(),
                nom: nomRepas,
                date: new Date().toISOString(),
                aliments: [...repasActuel],
                totaux: {
                    calories: Math.round(totaux.calories),
                    proteines: Math.round(totaux.proteines * 10) / 10,
                    glucides: Math.round(totaux.glucides * 10) / 10,
                    lipides: Math.round(totaux.lipides * 10) / 10
                }
            };

            repasSauvegardes.unshift(repas);
            localStorage.setItem('repas', JSON.stringify(repasSauvegardes));

            afficherHistoriqueRepas();
            repasActuel = [];
            afficherRepasActuel();

            afficherNotification('‚úÖ Repas sauvegard√© !', '#4caf50');
        }

        function afficherHistoriqueRepas() {
            const historique = document.getElementById('historiqueRepas');
            if (!historique) return;

            if (repasSauvegardes.length === 0) {
                historique.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">üçΩÔ∏è Aucun repas sauvegard√©</p>';
                return;
            }

            historique.innerHTML = repasSauvegardes.map((repas) => {
                const date = new Date(repas.date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' });
                return `
                    <div class="weight-item" style="flex-direction: column; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; width: 100%; margin-bottom: 12px;">
                            <strong style="color: #667eea; font-size: 1.15em;">üçΩÔ∏è ${repas.nom}</strong>
                            <span style="color: #999; font-size: 0.95em;">üìÖ ${date}</span>
                        </div>
                        <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%); padding: 15px; border-radius: 12px; width: 100%; border: 2px solid rgba(102, 126, 234, 0.1);">
                            <strong style="color: #667eea; font-size: 1.1em;">üî• ${repas.totaux.calories} kcal</strong> - 
                            üí™ ${repas.totaux.proteines}g prot - 
                            üçö ${repas.totaux.glucides}g gluc - 
                            ü•ë ${repas.totaux.lipides}g lip
                        </div>
                    </div>
                `;
            }).join('');
        }

        function afficherPlanning() {
            const jours = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'];
            const moments = ['Petit-d√©j', 'D√©jeuner', 'D√Æner'];
            const container = document.getElementById('planning-container');
            if (!container) return;
            
            container.innerHTML = jours.map(jour => `
                <div class="planning-day">
                    <div class="day-header">${jour}</div>
                    ${moments.map(moment => {
                        const key = `${jour}-${moment}`;
                        const repas = planningHebdo[key];
                        
                        return `
                            <div class="meal-slot" data-jour="${jour}" data-moment="${moment}">
                                <div class="meal-slot-title">${moment}</div>
                                ${repas ? `
                                    <div class="planned-meal">
                                        <strong style="font-size: 1.05em;">${repas.nom}</strong><br>
                                        <span style="font-size: 0.95em;">üî• ${Math.round(repas.calories)} kcal</span>
                                        <button class="delete-btn" onclick="supprimerDuPlanning('${key}')">√ó</button>
                                    </div>
                                ` : '<div style="text-align: center; color: #999; padding: 20px;">Glissez une recette ici</div>'}
                            </div>
                        `;
                    }).join('')}
                </div>
            `).join('');
        }

        function afficherRecettesPlanning() {
            const container = document.getElementById('recettes-planning-container');
            const recipesContainer = document.getElementById('recipes-planning');
            
            if (!container || !recipesContainer) return;
            
            if (container.style.display === 'none') {
                if (repasSauvegardes.length === 0) {
                    recipesContainer.innerHTML = `
                        <div style="text-align: center; padding: 60px; background: rgba(255, 255, 255, 0.5); border-radius: 20px; grid-column: 1/-1;">
                            <div style="font-size: 4em; margin-bottom: 15px;">üçΩÔ∏è</div>
                            <p style="color: #999; font-size: 1.1em; font-weight: 600;">Aucune recette disponible</p>
                            <p style="color: #999;">Cr√©ez vos recettes dans le Calculateur !</p>
                        </div>
                    `;
                } else {
                    recipesContainer.innerHTML = repasSauvegardes.map(repas => `
                        <div class="recipe-card" draggable="true" ondragstart="dragStartRepas(event)" data-repas='${JSON.stringify(repas).replace(/'/g, "&#39;")}'>
                            <div class="recipe-image">üçΩÔ∏è</div>
                            <div class="recipe-content">
                                <div class="recipe-title">${repas.nom}</div>
                                <span class="recipe-calories">üî• ${Math.round(repas.totaux.calories)} kcal</span>
                            </div>
                        </div>
                    `).join('');
                }
                container.style.display = 'block';
            } else {
                container.style.display = 'none';
            }
        }

        let repasDrague = null;

        function dragStartRepas(event) {
            const repasJson = event.currentTarget.dataset.repas;
            repasDrague = JSON.parse(repasJson);
        }

        document.addEventListener('dragover', function(e) {
            if (e.target.closest('.meal-slot')) {
                e.preventDefault();
                e.target.closest('.meal-slot').classList.add('drag-over');
            }
        });

        document.addEventListener('dragleave', function(e) {
            if (e.target.closest('.meal-slot')) {
                e.target.closest('.meal-slot').classList.remove('drag-over');
            }
        });

        document.addEventListener('drop', function(e) {
            const slot = e.target.closest('.meal-slot');
            if (slot && repasDrague) {
                e.preventDefault();
                slot.classList.remove('drag-over');
                
                const jour = slot.dataset.jour;
                const moment = slot.dataset.moment;
                const key = `${jour}-${moment}`;
                
                planningHebdo[key] = {
                    nom: repasDrague.nom,
                    calories: repasDrague.totaux.calories,
                    proteines: repasDrague.totaux.proteines,
                    glucides: repasDrague.totaux.glucides,
                    lipides: repasDrague.totaux.lipides
                };
                
                localStorage.setItem('planningHebdo', JSON.stringify(planningHebdo));
                afficherPlanning();
                afficherNotification('‚úÖ Repas ajout√© au planning !', '#4caf50');
            }
        });

        function supprimerDuPlanning(key) {
            delete planningHebdo[key];
            localStorage.setItem('planningHebdo', JSON.stringify(planningHebdo));
            afficherPlanning();
            afficherNotification('‚úÖ Repas retir√© du planning', '#ff4757');
        }

        function viderPlanning() {
            if (confirm('Vider tout le planning ?')) {
                planningHebdo = {};
                localStorage.setItem('planningHebdo', JSON.stringify(planningHebdo));
                afficherPlanning();
                afficherNotification('‚úÖ Planning vid√©', '#ff4757');
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            
            document.querySelectorAll('.tab').forEach(tab => {
                if (tab.getAttribute('onclick').includes(tabName)) {
                    tab.classList.add('active');
                }
            });

            if (tabName === 'suivi') {
                setTimeout(() => dessinerGraphique(), 100);
            } else if (tabName === 'planning') {
                afficherPlanning();
            }
        }

        // ==============================================
        // INITIALISATION
        // ==============================================
        
        window.addEventListener('load', function() {
            console.log('üì¶ Initialisation...');
            initialiserFirebase();
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            const data = localStorage.getItem('userData');
            if (data) {
                userData = JSON.parse(data);
                document.getElementById('nom').value = userData.nom || '';
                document.getElementById('sexe').value = userData.sexe || 'femme';
                document.getElementById('age').value = userData.age || '';
                document.getElementById('taille').value = userData.taille || '';
                document.getElementById('poids').value = userData.poids || '';
                document.getElementById('objectif').value = userData.objectif || '';
                document.getElementById('activite').value = userData.activite || '1.2';

                if (userData.imc) {
                    document.getElementById('resultatProfil').style.display = 'block';
                    document.getElementById('imcValue').textContent = userData.imc;
                    document.getElementById('poidsIdealValue').textContent = userData.poidsIdeal;
                    document.getElementById('aPerdrValue').textContent = Math.max(0, userData.poids - userData.objectif).toFixed(1);
                    document.getElementById('caloriesValue').textContent = userData.calories;
                }
            }
            
            afficherPesees();
            afficherHistoriqueRepas();
            afficherPlanning();
            
            const dateInput = document.getElementById('datePesee');
            if (dateInput) {
                dateInput.valueAsDate = new Date();
            }

            console.log('‚úÖ Application charg√©e - Design moderne activ√© ! üé®');
        });
    </script>
</body>
</html>
