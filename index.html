<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Coach Minceur - Le Secret du Poids</title>
    
    <!-- QuaggaJS pour le scanner de code-barres -->
    <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2@1.8.4/dist/quagga.min.js"></script>
    
    <!-- Firebase SDK - Version 9 compatible -->
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <style>
        /* ========================================
           DESIGN PROFESSIONNEL MODERNE
           ======================================== */
        
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1e40af;
            --secondary-color: #10b981;
            --accent-color: #f59e0b;
            --danger-color: #ef4444;
            --text-dark: #1f2937;
            --text-medium: #6b7280;
            --text-light: #9ca3af;
            --bg-light: #f9fafb;
            --bg-white: #ffffff;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-light);
            min-height: 100vh;
            color: var(--text-dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ========================================
           HEADER PROFESSIONNEL
           ======================================== */
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            padding: 40px 30px;
            border-radius: var(--radius-xl);
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 2.25em;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.02em;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
            font-weight: 400;
        }

        /* ========================================
           CARD MODERNE
           ======================================== */
        .card {
            background: var(--bg-white);
            border-radius: var(--radius-xl);
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }

        .card h2 {
            color: var(--text-dark);
            margin-bottom: 24px;
            font-size: 1.75em;
            font-weight: 700;
            letter-spacing: -0.01em;
        }

        /* ========================================
           NAVIGATION TABS MODERNE
           ======================================== */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            background: var(--bg-white);
            padding: 8px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-medium);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
        }

        .tab:hover {
            background: var(--bg-light);
            color: var(--text-dark);
        }

        .tab.active {
            background: var(--primary-color);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ========================================
           FORMULAIRES MODERNES
           ======================================== */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="password"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 15px;
            color: var(--text-dark);
            background: var(--bg-white);
            transition: all 0.2s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* ========================================
           BOUTONS PROFESSIONNELS
           ======================================== */
        .btn {
            padding: 12px 24px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.2s;
            box-shadow: var(--shadow-sm);
            display: inline-block;
            text-align: center;
        }

        .btn:hover {
            background: var(--primary-dark);
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.delete {
            background: var(--danger-color);
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn.delete:hover {
            background: #dc2626;
        }

        /* ========================================
           STATS CARDS PROFESSIONNELLES
           ======================================== */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            padding: 24px;
            border-radius: var(--radius-lg);
            text-align: center;
            box-shadow: var(--shadow-md);
            color: white;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-card .label {
            font-size: 14px;
            opacity: 0.9;
            font-weight: 500;
        }

        /* ========================================
           RESULT BOX MODERNE
           ======================================== */
        .result-box {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid #bae6fd;
            padding: 24px;
            border-radius: var(--radius-lg);
            margin-top: 24px;
        }

        .result-box h3 {
            color: var(--primary-color);
            margin-bottom: 16px;
            font-size: 1.25em;
            font-weight: 700;
        }

        /* ========================================
           WEIGHT ITEMS MODERNES
           ======================================== */
        .weight-history {
            margin-top: 30px;
        }

        .weight-history h3 {
            color: var(--text-dark);
            margin-bottom: 16px;
            font-size: 1.25em;
            font-weight: 700;
        }

        .weight-item {
            background: var(--bg-light);
            padding: 16px;
            border-radius: var(--radius-md);
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border-color);
        }

        .weight-entry {
            background: var(--bg-light);
            padding: 20px;
            border-radius: var(--radius-lg);
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
        }

        /* ========================================
           NOTIFICATIONS MODERNES
           ======================================== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            z-index: 10000;
            min-width: 300px;
            border-left: 4px solid var(--primary-color);
            font-weight: 500;
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ========================================
           AUTHENTIFICATION MODERNE ET MAGNIFIQUE
           ======================================== */
        #authModal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
            overflow-y: auto;
        }

        .auth-container {
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 480px;
            width: 100%;
            padding: 48px 40px;
            animation: slideInUp 0.4s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .auth-header h2 {
            color: var(--text-dark);
            font-size: 2em;
            font-weight: 700;
            margin: 0 0 8px 0;
            letter-spacing: -0.02em;
        }

        .auth-header p {
            color: var(--text-medium);
            font-size: 1em;
            margin: 0;
        }

        .auth-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 32px;
            background: var(--bg-light);
            padding: 6px;
            border-radius: 12px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            color: var(--text-medium);
            transition: all 0.2s ease;
        }

        .auth-tab:hover {
            color: var(--text-dark);
        }

        .auth-tab.active {
            background: white;
            color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }

        .auth-input-group {
            margin-bottom: 20px;
        }

        .auth-input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 14px;
        }

        .auth-input-group input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 15px;
            color: var(--text-dark);
            background: white;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .auth-input-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        }

        .auth-input-group input::placeholder {
            color: var(--text-light);
        }

        .auth-btn {
            width: 100%;
            padding: 16px 24px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
            margin-top: 8px;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
        }

        .auth-btn:active {
            transform: translateY(0);
        }

        .auth-error {
            background: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
            animation: shake 0.5s;
        }

        .auth-error:not(:empty) {
            display: block;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .auth-success {
            background: #efe;
            border: 1px solid #cfc;
            color: #3c3;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        .auth-success:not(:empty) {
            display: block;
        }

        /* Responsive mobile */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.75em;
            }

            .card {
                padding: 20px;
            }

            .tabs {
                justify-content: center;
            }

            .tab {
                font-size: 13px;
                padding: 8px 16px;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .auth-container {
                padding: 32px 24px;
                margin: 20px;
            }

            .auth-header h2 {
                font-size: 1.75em;
            }

            .auth-tabs {
                flex-direction: column;
            }

            .auth-tab {
                width: 100%;
            }
        }

        /* ========================================
           ANIMATIONS SUBTILES
           ======================================== */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.8;
            }
        }

        .loading {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Planning hebdomadaire */
        .planning-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .planning-day {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .day-header {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #667eea;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .meal-slot {
            background: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            min-height: 80px;
            transition: all 0.3s;
        }

        .meal-slot:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .meal-slot.drag-over {
            background: #e0f2fe;
            border-color: #0ea5e9;
        }

        .meal-slot-title {
            font-weight: 600;
            color: #666;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .planned-meal {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            border-radius: 8px;
            position: relative;
        }

        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Recettes */
        .recipes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .recipe-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: grab;
            transition: transform 0.2s;
        }

        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .recipe-image {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
        }

        .recipe-content {
            padding: 15px;
        }

        .recipe-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .recipe-info {
            font-size: 0.9em;
            color: #666;
        }

        .recipe-calories {
            display: inline-block;
            background: #4caf50;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 5px;
        }

        .progress-bar {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            overflow: hidden;
            height: 20px;
        }

        .progress-fill {
            background: white;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
            font-weight: bold;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <!-- Modal de connexion/inscription -->
    <div id="authModal" style="display: none;">
        <div class="auth-container">
            <div class="auth-header">
                <div style="font-size: 4em; margin-bottom: 15px;">üöÄ</div>
                <h2>Mon Coach Minceur</h2>
                <p>Connectez-vous pour acc√©der √† toutes les fonctionnalit√©s</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Connexion</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">Inscription</button>
            </div>

            <div id="authError" class="auth-error"></div>
            <div id="authSuccess" class="auth-success"></div>

            <!-- Formulaire de connexion -->
            <form id="loginForm" class="auth-form active" onsubmit="connexion(event)">
                <div class="auth-input-group">
                    <label>üìß Email</label>
                    <input type="email" id="loginEmail" placeholder="votre@email.com" required>
                </div>
                <div class="auth-input-group">
                    <label>üîí Mot de passe</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="auth-btn" id="loginBtn">
                    Se connecter
                </button>
            </form>

            <!-- Formulaire d'inscription -->
            <form id="registerForm" class="auth-form" onsubmit="inscription(event)">
                <div class="auth-input-group">
                    <label>üë§ Nom d'utilisateur</label>
                    <input type="text" id="registerName" placeholder="Votre nom" required>
                </div>
                <div class="auth-input-group">
                    <label>üìß Email</label>
                    <input type="email" id="registerEmail" placeholder="votre@email.com" required>
                </div>
                <div class="auth-input-group">
                    <label>üîí Mot de passe</label>
                    <input type="password" id="registerPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6" required>
                    <small style="color: #999; font-size: 0.85em;">Minimum 6 caract√®res</small>
                </div>
                <div class="auth-input-group">
                    <label>üîí Confirmer le mot de passe</label>
                    <input type="password" id="registerPasswordConfirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6" required>
                </div>
                <button type="submit" class="auth-btn" id="registerBtn">
                    Cr√©er mon compte
                </button>
            </form>

            <div style="text-align: center; margin-top: 30px; padding: 20px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 12px; border: 2px solid #bae6fd;">
                <div style="font-size: 2em; margin-bottom: 10px;">üåç</div>
                <div style="color: #0369a1; font-size: 0.95em; font-weight: 600;">Rejoignez la communaut√© Mon Coach Minceur</div>
                <div style="color: #0284c7; font-size: 0.85em; margin-top: 5px;">Des milliers d'utilisateurs vous attendent !</div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üí™ Mon Coach Minceur</h1>
            <div id="userBadgeContainer" style="margin: 10px 0;"></div>
            <p>Votre programme personnalis√© pour atteindre vos objectifs</p>
        </div>

        <div class="card">
            <div class="tabs">
                <button class="tab active" onclick="showTab('profil')">üìä Mon Profil</button>
                <button class="tab" onclick="showTab('suivi')">‚öñÔ∏è Suivi</button>
                <button class="tab" onclick="showTab('calculateur')">üßÆ Calculateur</button>
                <button class="tab" onclick="showTab('planning')">üìÖ Planning</button>
                <button class="tab" onclick="showTab('conseils')">üí° Conseils</button>
            </div>

            <!-- Onglet Profil -->
            <div id="profil" class="tab-content active">
                <h2>Cr√©ez votre profil personnalis√©</h2>
                
                <div class="form-group">
                    <label>Nom / Pr√©nom</label>
                    <input type="text" id="nom" placeholder="Entrez votre nom">
                </div>

                <div class="form-group">
                    <label>Sexe</label>
                    <select id="sexe">
                        <option value="femme">Femme</option>
                        <option value="homme">Homme</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>√Çge (ann√©es)</label>
                    <input type="number" id="age" placeholder="25" min="10" max="100">
                </div>

                <div class="form-group">
                    <label>Taille (cm)</label>
                    <input type="number" id="taille" placeholder="170" min="100" max="250">
                </div>

                <div class="form-group">
                    <label>Poids actuel (kg)</label>
                    <input type="number" id="poids" placeholder="70" step="0.1" min="30" max="300">
                </div>

                <div class="form-group">
                    <label>Poids objectif (kg)</label>
                    <input type="number" id="objectif" placeholder="65" step="0.1" min="30" max="300">
                </div>

                <div class="form-group">
                    <label>Niveau d'activit√©</label>
                    <select id="activite">
                        <option value="1.2">S√©dentaire (peu ou pas d'exercice)</option>
                        <option value="1.375">L√©g√®rement actif (exercice 1-3 jours/semaine)</option>
                        <option value="1.55">Mod√©r√©ment actif (exercice 3-5 jours/semaine)</option>
                        <option value="1.725">Tr√®s actif (exercice 6-7 jours/semaine)</option>
                        <option value="1.9">Extr√™mement actif (exercice intense quotidien)</option>
                    </select>
                </div>

                <button class="btn" onclick="calculerProfil()">Calculer mon programme</button>

                <div id="resultatProfil" class="result-box" style="display: none;">
                    <h3>Votre bilan personnalis√©</h3>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="value" id="imcValue">-</div>
                            <div class="label">IMC</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="poidsIdealValue">-</div>
                            <div class="label">Poids id√©al (kg)</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="aPerdrValue">-</div>
                            <div class="label">√Ä perdre (kg)</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="caloriesValue">-</div>
                            <div class="label">Calories/jour</div>
                        </div>
                    </div>
                    <div id="imcCategorie" style="margin-top: 15px; font-size: 1.1em;"></div>
                    <div id="dureeProgramme" style="margin-top: 10px;"></div>
                </div>
            </div>

            <!-- Onglet Suivi -->
            <div id="suivi" class="tab-content">
                <h2>üìä Mon Suivi</h2>
                
                <div class="weight-entry">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Date</label>
                        <input type="date" id="datePesee">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Poids (kg)</label>
                        <input type="number" id="poidsPesee" step="0.1" placeholder="70.5">
                    </div>
                    <button class="btn" onclick="ajouterPesee()" style="margin-top: 0;">Ajouter</button>
                </div>

                <div id="progressionActuelle"></div>

                <canvas id="graphiquePoids" width="400" height="200"></canvas>

                <div class="weight-history">
                    <h3 style="margin-bottom: 15px;">Historique des pes√©es</h3>
                    <div id="listePesees"></div>
                </div>
            </div>

            <!-- Onglet Calculateur -->
            <div id="calculateur" class="tab-content">
                <h2>Calculateur de Calories</h2>
                
                <div style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <p style="text-align: center; color: #333; font-size: 1.1em;">
                        üî¢ Calculez les calories de vos aliments
                    </p>
                </div>

                <div style="background: white; border: 2px solid #667eea; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üîç Rechercher un aliment</h3>
                    
                    <div class="form-group">
                        <label>Nom de l'aliment</label>
                        <input type="text" id="searchAliment" placeholder="Ex: poulet, pomme, riz..." oninput="rechercherAliment()">
                        <div id="suggestionsAliments" style="background: white; border: 1px solid #e0e0e0; border-radius: 5px; margin-top: 5px; max-height: 300px; overflow-y: auto; display: none;"></div>
                    </div>

                    <div class="form-group">
                        <label>Quantit√© (grammes)</label>
                        <input type="number" id="quantiteAliment" placeholder="100" min="1" step="1">
                    </div>

                    <button class="btn" onclick="ajouterAlimentCalcul()">‚ûï Ajouter √† mon repas</button>
                </div>

                <div id="repasActuel" style="display: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">üçΩÔ∏è Votre repas actuel</h3>
                    
                    <div id="listeAlimentsRepas" style="margin-bottom: 15px;"></div>

                    <div class="stats" style="margin-top: 15px;">
                        <div class="stat-card" style="background: rgba(255, 255, 255, 0.2);">
                            <div class="value" id="totalCalories">0</div>
                            <div class="label">Calories (kcal)</div>
                        </div>
                        <div class="stat-card" style="background: rgba(255, 255, 255, 0.2);">
                            <div class="value" id="totalProteines">0</div>
                            <div class="label">Prot√©ines (g)</div>
                        </div>
                        <div class="stat-card" style="background: rgba(255, 255, 255, 0.2);">
                            <div class="value" id="totalGlucides">0</div>
                            <div class="label">Glucides (g)</div>
                        </div>
                        <div class="stat-card" style="background: rgba(255, 255, 255, 0.2);">
                            <div class="value" id="totalLipides">0</div>
                            <div class="label">Lipides (g)</div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn" onclick="sauvegarderRepas()" style="flex: 1; background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);">üíæ Sauvegarder</button>
                        <button class="btn" onclick="reinitialiserRepas()" style="flex: 1; background: linear-gradient(135deg, #ff4757 0%, #e84118 100%);">üóëÔ∏è Vider</button>
                    </div>
                </div>

                <div style="margin-top: 30px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üìÖ Historique de mes repas</h3>
                    <div id="historiqueRepas"></div>
                </div>
            </div>

            <!-- Onglet Planning -->
            <div id="planning" class="tab-content">
                <h2>üìÖ Planning de la Semaine</h2>
                
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <button class="btn" onclick="afficherRecettesPlanning()">
                        üç≥ Voir mes recettes
                    </button>
                    <button class="btn" onclick="viderPlanning()" style="background: linear-gradient(135deg, #ff4757 0%, #e84118 100%);">
                        üóëÔ∏è Vider le planning
                    </button>
                </div>

                <div id="recettes-planning-container" style="display: none; margin-bottom: 30px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">Mes Recettes Disponibles</h3>
                    <div class="recipes-grid" id="recipes-planning"></div>
                </div>

                <div class="planning-grid" id="planning-container"></div>
            </div>

            <!-- Onglet Conseils -->
            <div id="conseils" class="tab-content">
                <h2>üí° Conseils Nutrition</h2>
                
                <div style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="color: #2e7d32; margin-bottom: 15px;">ü•ó R√®gle n¬∞1 : L'√©quilibre alimentaire</h3>
                    <p style="color: #333;">Privil√©giez une alimentation vari√©e et √©quilibr√©e. Chaque repas devrait contenir des prot√©ines, des glucides complexes, des l√©gumes et de bonnes graisses.</p>
                </div>

                <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="color: #1565c0; margin-bottom: 15px;">üíß R√®gle n¬∞2 : L'hydratation</h3>
                    <p style="color: #333;">Buvez au moins 1,5 √† 2 litres d'eau par jour. L'eau aide √† √©liminer les toxines et favorise la digestion.</p>
                </div>

                <div style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); padding: 20px; border-radius: 10px;">
                    <h3 style="color: #e65100; margin-bottom: 15px;">‚è∞ R√®gle n¬∞3 : Les horaires r√©guliers</h3>
                    <p style="color: #333;">Mangez √† heures fixes pour r√©guler votre m√©tabolisme. Id√©alement : petit-d√©jeuner avant 9h, d√©jeuner entre 12h et 13h, d√Æner avant 20h.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==============================================
        // CONFIGURATION FIREBASE
        // ==============================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyAVsE39uVXpYQy_aehNS8f_bo94U-NWI28",
            authDomain: "moncoachminceurcatjer.firebaseapp.com",
            projectId: "moncoachminceurcatjer",
            storageBucket: "moncoachminceurcatjer.firebasestorage.app",
            messagingSenderId: "441403074242",
            appId: "1:441403074242:web:b38009005e7fa4e012bd5b"
        };

        let db = null;
        let auth = null;
        let firebaseInitialized = false;
        let currentUser = null;

        function initialiserFirebase() {
            if (typeof firebase === 'undefined') {
                setTimeout(initialiserFirebase, 100);
                return;
            }

            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                firebaseInitialized = true;
                
                console.log('‚úÖ Firebase initialis√©');
                
                auth.onAuthStateChanged(function(user) {
                    if (user) {
                        currentUser = user;
                        console.log('üë§ Utilisateur connect√©:', user.email);
                        
                        const modal = document.getElementById('authModal');
                        if (modal) modal.style.display = 'none';
                        
                        afficherBadgeUtilisateur();
                    } else {
                        currentUser = null;
                        const modal = document.getElementById('authModal');
                        if (modal) modal.style.display = 'flex';
                    }
                });

            } catch (error) {
                console.log('‚ö†Ô∏è Erreur Firebase:', error);
                firebaseInitialized = false;
            }
        }

        // ==============================================
        // AUTHENTIFICATION
        // ==============================================

        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelector('.auth-tab:first-child').classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelector('.auth-tab:last-child').classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
            
            hideAuthMessages();
        }

        function showAuthError(message) {
            const errorDiv = document.getElementById('authError');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
            }
        }

        function showAuthSuccess(message) {
            const successDiv = document.getElementById('authSuccess');
            if (successDiv) {
                successDiv.textContent = message;
                successDiv.style.display = 'block';
            }
        }

        function hideAuthMessages() {
            const errorDiv = document.getElementById('authError');
            const successDiv = document.getElementById('authSuccess');
            if (errorDiv) errorDiv.style.display = 'none';
            if (successDiv) successDiv.style.display = 'none';
        }

        async function inscription(event) {
            event.preventDefault();
            
            if (!firebaseInitialized || !auth) {
                showAuthError('Firebase non initialis√©');
                return;
            }
            
            hideAuthMessages();

            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;

            if (password !== passwordConfirm) {
                showAuthError('Les mots de passe ne correspondent pas');
                return;
            }

            const btn = document.getElementById('registerBtn');
            btn.disabled = true;
            btn.textContent = 'Cr√©ation en cours...';

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                
                await userCredential.user.updateProfile({
                    displayName: name
                });

                await db.collection('users').doc(userCredential.user.uid).set({
                    nom: name,
                    email: email,
                    dateInscription: firebase.firestore.FieldValue.serverTimestamp()
                });

                showAuthSuccess('‚úÖ Compte cr√©√© avec succ√®s !');
                
                setTimeout(() => {
                    const modal = document.getElementById('authModal');
                    if (modal) modal.style.display = 'none';
                    afficherNotification('üéâ Bienvenue ' + name + ' !');
                }, 1500);

            } catch (error) {
                console.error('Erreur inscription:', error);
                let message = 'Erreur lors de l\'inscription';
                
                if (error.code === 'auth/email-already-in-use') {
                    message = 'Cet email est d√©j√† utilis√©';
                } else if (error.code === 'auth/weak-password') {
                    message = 'Le mot de passe est trop faible';
                }
                
                showAuthError(message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Cr√©er mon compte';
            }
        }

        async function connexion(event) {
            event.preventDefault();
            
            if (!firebaseInitialized || !auth) {
                showAuthError('Firebase non initialis√©');
                return;
            }
            
            hideAuthMessages();

            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            const btn = document.getElementById('loginBtn');
            btn.disabled = true;
            btn.textContent = 'Connexion...';

            try {
                await auth.signInWithEmailAndPassword(email, password);
                showAuthSuccess('‚úÖ Connexion r√©ussie !');
                
                setTimeout(() => {
                    const modal = document.getElementById('authModal');
                    if (modal) modal.style.display = 'none';
                }, 1000);

            } catch (error) {
                console.error('Erreur connexion:', error);
                let message = 'Erreur lors de la connexion';
                
                if (error.code === 'auth/user-not-found') {
                    message = 'Aucun compte avec cet email';
                } else if (error.code === 'auth/wrong-password') {
                    message = 'Mot de passe incorrect';
                }
                
                showAuthError(message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Se connecter';
            }
        }

        async function deconnexion() {
            if (!confirm('Voulez-vous vraiment vous d√©connecter ?')) return;

            try {
                await auth.signOut();
                afficherNotification('üëã √Ä bient√¥t !');
                setTimeout(() => location.reload(), 1000);
            } catch (error) {
                console.error('Erreur d√©connexion:', error);
            }
        }

        function afficherBadgeUtilisateur() {
            const container = document.getElementById('userBadgeContainer');
            if (container && currentUser) {
                container.innerHTML = `
                    <div style="background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 20px; display: inline-block;">
                        <span style="margin-right: 10px;">üë§ ${currentUser.displayName || currentUser.email}</span>
                        <button onclick="deconnexion()" style="background: rgba(255,255,255,0.3); border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; color: white;">
                            üö™ D√©connexion
                        </button>
                    </div>
                `;
            }
        }

        // ==============================================
        // DONN√âES ET FONCTIONS
        // ==============================================

        let userData = JSON.parse(localStorage.getItem('userData')) || {};
        let pesees = JSON.parse(localStorage.getItem('pesees')) || [];
        let repasActuel = [];
        let repasSauvegardes = JSON.parse(localStorage.getItem('repas')) || [];
        let planningHebdo = JSON.parse(localStorage.getItem('planningHebdo')) || {};

        const baseAliments = [
            { nom: "Poulet", calories: 165, proteines: 31, glucides: 0, lipides: 3.6 },
            { nom: "Riz", calories: 130, proteines: 2.7, glucides: 28, lipides: 0.3 },
            { nom: "P√¢tes", calories: 131, proteines: 5, glucides: 25, lipides: 1.1 },
            { nom: "Pomme", calories: 52, proteines: 0.3, glucides: 14, lipides: 0.2 },
            { nom: "Banane", calories: 89, proteines: 1.1, glucides: 23, lipides: 0.3 },
            { nom: "Tomate", calories: 18, proteines: 0.9, glucides: 3.9, lipides: 0.2 },
            { nom: "Carotte", calories: 41, proteines: 0.9, glucides: 10, lipides: 0.2 },
            { nom: "Brocoli", calories: 34, proteines: 2.8, glucides: 7, lipides: 0.4 }
        ];

        function afficherNotification(message, couleur = '#4caf50') {
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.style.background = couleur;
            notif.style.color = 'white';
            notif.textContent = message;
            document.body.appendChild(notif);

            setTimeout(() => {
                notif.style.opacity = '0';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }

        function calculerProfil() {
            const nom = document.getElementById('nom').value;
            const sexe = document.getElementById('sexe').value;
            const age = parseFloat(document.getElementById('age').value);
            const taille = parseFloat(document.getElementById('taille').value);
            const poids = parseFloat(document.getElementById('poids').value);
            const objectif = parseFloat(document.getElementById('objectif').value);
            const activite = parseFloat(document.getElementById('activite').value);

            if (!nom || !age || !taille || !poids || !objectif) {
                alert('Veuillez remplir tous les champs');
                return;
            }

            const imc = (poids / ((taille / 100) ** 2)).toFixed(1);
            
            let poidsIdeal;
            if (sexe === 'homme') {
                poidsIdeal = (taille - 100 - ((taille - 150) / 4)).toFixed(1);
            } else {
                poidsIdeal = (taille - 100 - ((taille - 150) / 2.5)).toFixed(1);
            }

            const aPerdre = Math.max(0, poids - objectif).toFixed(1);

            let bmr;
            if (sexe === 'homme') {
                bmr = 88.362 + (13.397 * poids) + (4.799 * taille) - (5.677 * age);
            } else {
                bmr = 447.593 + (9.247 * poids) + (3.098 * taille) - (4.330 * age);
            }
            const calories = Math.round((bmr * activite) - 500);

            let categorieIMC;
            if (imc < 18.5) {
                categorieIMC = "Insuffisance pond√©rale";
            } else if (imc < 25) {
                categorieIMC = "Poids normal üéâ";
            } else if (imc < 30) {
                categorieIMC = "Surpoids üí™";
            } else {
                categorieIMC = "Ob√©sit√© üåü";
            }

            document.getElementById('imcValue').textContent = imc;
            document.getElementById('poidsIdealValue').textContent = poidsIdeal;
            document.getElementById('aPerdrValue').textContent = aPerdre;
            document.getElementById('caloriesValue').textContent = calories;
            document.getElementById('imcCategorie').innerHTML = `<strong>Cat√©gorie :</strong> ${categorieIMC}`;

            const semaines = Math.ceil(aPerdre / 0.5);
            document.getElementById('dureeProgramme').innerHTML = `<strong>Dur√©e estim√©e :</strong> ${semaines} semaines`;

            document.getElementById('resultatProfil').style.display = 'block';

            userData = { nom, sexe, age, taille, poids, objectif, activite, imc, poidsIdeal, calories };
            localStorage.setItem('userData', JSON.stringify(userData));

            afficherNotification('‚úÖ Profil cr√©√© avec succ√®s !');
        }

        function ajouterPesee() {
            const date = document.getElementById('datePesee').value;
            const poids = parseFloat(document.getElementById('poidsPesee').value);

            if (!date || !poids) {
                alert('Veuillez remplir tous les champs');
                return;
            }

            pesees.push({ date, poids });
            pesees.sort((a, b) => new Date(a.date) - new Date(b.date));
            localStorage.setItem('pesees', JSON.stringify(pesees));

            afficherPesees();
            dessinerGraphique();

            document.getElementById('poidsPesee').value = '';
            afficherNotification('‚úÖ Pes√©e enregistr√©e !');
        }

        function afficherPesees() {
            const liste = document.getElementById('listePesees');
            if (!liste) return;

            if (pesees.length === 0) {
                liste.innerHTML = '<p style="text-align: center; color: #999;">Aucune pes√©e enregistr√©e</p>';
                return;
            }

            liste.innerHTML = '';
            [...pesees].reverse().forEach((pesee, index) => {
                const realIndex = pesees.length - 1 - index;
                const div = document.createElement('div');
                div.className = 'weight-item';
                
                const dateFormatee = new Date(pesee.date + 'T00:00:00').toLocaleDateString('fr-FR');

                div.innerHTML = `
                    <span>${dateFormatee}</span>
                    <span>${pesee.poids} kg</span>
                    <button class="btn delete" onclick="supprimerPesee(${realIndex})">Supprimer</button>
                `;
                liste.appendChild(div);
            });

            afficherProgression();
        }

        function afficherProgression() {
            const progressionDiv = document.getElementById('progressionActuelle');
            if (!progressionDiv) return;
            
            if (pesees.length === 0 || !userData.objectif) {
                progressionDiv.innerHTML = '';
                return;
            }

            const poidsActuel = pesees[pesees.length - 1].poids;
            const poidsDepart = pesees[0].poids;
            const objectif = userData.objectif;

            const totalAPerdre = poidsDepart - objectif;
            const dejaPerdu = poidsDepart - poidsActuel;
            const pourcentage = Math.min(100, Math.max(0, (dejaPerdu / totalAPerdre) * 100));

            progressionDiv.innerHTML = `
                <div style="background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <h3 style="color: white; margin-bottom: 10px;">üìä Votre progression</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${pourcentage}%">${pourcentage.toFixed(1)}%</div>
                    </div>
                    <div style="color: white; margin-top: 10px; text-align: center;">
                        <strong>Perdu: ${dejaPerdu.toFixed(1)} kg</strong> sur ${totalAPerdre.toFixed(1)} kg
                    </div>
                </div>
            `;
        }

        function supprimerPesee(index) {
            if (confirm('Voulez-vous vraiment supprimer cette pes√©e ?')) {
                pesees.splice(index, 1);
                localStorage.setItem('pesees', JSON.stringify(pesees));
                afficherPesees();
                dessinerGraphique();
            }
        }

        function dessinerGraphique() {
            const canvas = document.getElementById('graphiquePoids');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = 300;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (pesees.length === 0) {
                ctx.fillStyle = '#999';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Aucune donn√©e', canvas.width / 2, canvas.height / 2);
                return;
            }

            const padding = 50;
            const poids = pesees.map(p => p.poids);
            const minPoids = Math.min(...poids) - 2;
            const maxPoids = Math.max(...poids) + 2;

            // Dessiner la ligne
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();

            pesees.forEach((pesee, index) => {
                const x = padding + (index / (pesees.length - 1 || 1)) * (canvas.width - 2 * padding);
                const y = canvas.height - padding - ((pesee.poids - minPoids) / (maxPoids - minPoids)) * (canvas.height - 2 * padding);

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }

                ctx.fillStyle = '#667eea';
                ctx.fillRect(x - 4, y - 4, 8, 8);
            });

            ctx.stroke();
        }

        function rechercherAliment() {
            const recherche = document.getElementById('searchAliment').value.toLowerCase();
            const suggestions = document.getElementById('suggestionsAliments');

            if (recherche.length < 2) {
                suggestions.style.display = 'none';
                return;
            }

            const resultats = baseAliments.filter(aliment => 
                aliment.nom.toLowerCase().includes(recherche)
            );

            if (resultats.length === 0) {
                suggestions.style.display = 'none';
                return;
            }

            suggestions.innerHTML = resultats.map(aliment => `
                <div style="padding: 12px; border-bottom: 1px solid #f0f0f0; cursor: pointer;" 
                     onclick="selectionnerAliment('${aliment.nom}')">
                    <div style="font-weight: bold;">${aliment.nom}</div>
                    <div style="font-size: 0.9em; color: #666;">
                        ${aliment.calories} kcal - ${aliment.proteines}g prot
                    </div>
                </div>
            `).join('');

            suggestions.style.display = 'block';
        }

        function selectionnerAliment(nom) {
            document.getElementById('searchAliment').value = nom;
            document.getElementById('suggestionsAliments').style.display = 'none';
            document.getElementById('quantiteAliment').focus();
        }

        function ajouterAlimentCalcul() {
            const nomAliment = document.getElementById('searchAliment').value.trim();
            const quantite = parseFloat(document.getElementById('quantiteAliment').value);

            if (!nomAliment || !quantite) {
                alert('Veuillez remplir tous les champs');
                return;
            }

            const aliment = baseAliments.find(a => a.nom.toLowerCase() === nomAliment.toLowerCase());
            
            if (!aliment) {
                alert('Aliment non trouv√©');
                return;
            }

            const facteur = quantite / 100;
            const alimentCalcule = {
                nom: aliment.nom,
                quantite: quantite,
                calories: aliment.calories * facteur,
                proteines: aliment.proteines * facteur,
                glucides: aliment.glucides * facteur,
                lipides: aliment.lipides * facteur
            };

            repasActuel.push(alimentCalcule);
            afficherRepasActuel();

            document.getElementById('searchAliment').value = '';
            document.getElementById('quantiteAliment').value = '';
            
            afficherNotification(`‚úÖ ${aliment.nom} ajout√©`);
        }

        function afficherRepasActuel() {
            if (repasActuel.length === 0) {
                document.getElementById('repasActuel').style.display = 'none';
                return;
            }

            document.getElementById('repasActuel').style.display = 'block';

            const liste = document.getElementById('listeAlimentsRepas');
            liste.innerHTML = repasActuel.map((aliment, index) => `
                <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between;">
                    <div>
                        <strong>${aliment.nom} (${aliment.quantite}g)</strong><br>
                        <span style="font-size: 0.9em;">${Math.round(aliment.calories)} kcal</span>
                    </div>
                    <button onclick="retirerAliment(${index})" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer;">üóëÔ∏è</button>
                </div>
            `).join('');

            const totaux = repasActuel.reduce((acc, aliment) => ({
                calories: acc.calories + aliment.calories,
                proteines: acc.proteines + aliment.proteines,
                glucides: acc.glucides + aliment.glucides,
                lipides: acc.lipides + aliment.lipides
            }), { calories: 0, proteines: 0, glucides: 0, lipides: 0 });

            document.getElementById('totalCalories').textContent = Math.round(totaux.calories);
            document.getElementById('totalProteines').textContent = Math.round(totaux.proteines * 10) / 10;
            document.getElementById('totalGlucides').textContent = Math.round(totaux.glucides * 10) / 10;
            document.getElementById('totalLipides').textContent = Math.round(totaux.lipides * 10) / 10;
        }

        function retirerAliment(index) {
            repasActuel.splice(index, 1);
            afficherRepasActuel();
        }

        function reinitialiserRepas() {
            if (confirm('Vider ce repas ?')) {
                repasActuel = [];
                afficherRepasActuel();
            }
        }

        function sauvegarderRepas() {
            if (repasActuel.length === 0) {
                alert('Ajoutez des aliments avant de sauvegarder');
                return;
            }

            const nomRepas = prompt('Nom du repas :', '');
            if (!nomRepas) return;

            const totaux = repasActuel.reduce((acc, aliment) => ({
                calories: acc.calories + aliment.calories,
                proteines: acc.proteines + aliment.proteines,
                glucides: acc.glucides + aliment.glucides,
                lipides: acc.lipides + aliment.lipides
            }), { calories: 0, proteines: 0, glucides: 0, lipides: 0 });

            const repas = {
                id: Date.now(),
                nom: nomRepas,
                date: new Date().toISOString(),
                aliments: [...repasActuel],
                totaux: {
                    calories: Math.round(totaux.calories),
                    proteines: Math.round(totaux.proteines * 10) / 10,
                    glucides: Math.round(totaux.glucides * 10) / 10,
                    lipides: Math.round(totaux.lipides * 10) / 10
                }
            };

            repasSauvegardes.unshift(repas);
            localStorage.setItem('repas', JSON.stringify(repasSauvegardes));

            afficherHistoriqueRepas();
            repasActuel = [];
            afficherRepasActuel();

            afficherNotification('‚úÖ Repas sauvegard√© !');
        }

        function afficherHistoriqueRepas() {
            const historique = document.getElementById('historiqueRepas');
            if (!historique) return;

            if (repasSauvegardes.length === 0) {
                historique.innerHTML = '<p style="text-align: center; color: #999;">Aucun repas sauvegard√©</p>';
                return;
            }

            historique.innerHTML = repasSauvegardes.map((repas, index) => {
                const date = new Date(repas.date).toLocaleDateString('fr-FR');
                return `
                    <div class="weight-item" style="flex-direction: column; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <strong style="color: #667eea;">${repas.nom}</strong>
                            <span style="color: #999;">${date}</span>
                        </div>
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 8px;">
                            <strong>${repas.totaux.calories} kcal</strong> - 
                            ${repas.totaux.proteines}g prot - 
                            ${repas.totaux.glucides}g gluc - 
                            ${repas.totaux.lipides}g lip
                        </div>
                    </div>
                `;
            }).join('');
        }

        function afficherPlanning() {
            const jours = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'];
            const moments = ['Petit-d√©j', 'D√©jeuner', 'D√Æner'];
            const container = document.getElementById('planning-container');
            if (!container) return;
            
            container.innerHTML = jours.map(jour => `
                <div class="planning-day">
                    <div class="day-header">${jour}</div>
                    ${moments.map(moment => {
                        const key = `${jour}-${moment}`;
                        const repas = planningHebdo[key];
                        
                        return `
                            <div class="meal-slot" data-jour="${jour}" data-moment="${moment}">
                                <div class="meal-slot-title">${moment}</div>
                                ${repas ? `
                                    <div class="planned-meal">
                                        <strong>${repas.nom}</strong><br>
                                        ${Math.round(repas.calories)} kcal
                                        <button class="delete-btn" onclick="supprimerDuPlanning('${key}')">√ó</button>
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    }).join('')}
                </div>
            `).join('');
        }

        function afficherRecettesPlanning() {
            const container = document.getElementById('recettes-planning-container');
            const recipesContainer = document.getElementById('recipes-planning');
            
            if (!container || !recipesContainer) return;
            
            if (container.style.display === 'none') {
                if (repasSauvegardes.length === 0) {
                    recipesContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <p style="color: #999;">Aucune recette. Cr√©ez-en dans le Calculateur !</p>
                        </div>
                    `;
                } else {
                    recipesContainer.innerHTML = repasSauvegardes.map(repas => `
                        <div class="recipe-card" draggable="true" ondragstart="dragStartRepas(event)" data-repas='${JSON.stringify(repas).replace(/'/g, "&#39;")}'>
                            <div class="recipe-image">üçΩÔ∏è</div>
                            <div class="recipe-content">
                                <div class="recipe-title">${repas.nom}</div>
                                <span class="recipe-calories">${Math.round(repas.totaux.calories)} kcal</span>
                            </div>
                        </div>
                    `).join('');
                }
                container.style.display = 'block';
            } else {
                container.style.display = 'none';
            }
        }

        let repasDrague = null;

        function dragStartRepas(event) {
            const repasJson = event.currentTarget.dataset.repas;
            repasDrague = JSON.parse(repasJson);
        }

        document.addEventListener('dragover', function(e) {
            if (e.target.closest('.meal-slot')) {
                e.preventDefault();
                e.target.closest('.meal-slot').classList.add('drag-over');
            }
        });

        document.addEventListener('dragleave', function(e) {
            if (e.target.closest('.meal-slot')) {
                e.target.closest('.meal-slot').classList.remove('drag-over');
            }
        });

        document.addEventListener('drop', function(e) {
            const slot = e.target.closest('.meal-slot');
            if (slot && repasDrague) {
                e.preventDefault();
                slot.classList.remove('drag-over');
                
                const jour = slot.dataset.jour;
                const moment = slot.dataset.moment;
                const key = `${jour}-${moment}`;
                
                planningHebdo[key] = {
                    nom: repasDrague.nom,
                    calories: repasDrague.totaux.calories,
                    proteines: repasDrague.totaux.proteines,
                    glucides: repasDrague.totaux.glucides,
                    lipides: repasDrague.totaux.lipides
                };
                
                localStorage.setItem('planningHebdo', JSON.stringify(planningHebdo));
                afficherPlanning();
                afficherNotification('‚úÖ Repas ajout√© !');
            }
        });

        function supprimerDuPlanning(key) {
            delete planningHebdo[key];
            localStorage.setItem('planningHebdo', JSON.stringify(planningHebdo));
            afficherPlanning();
        }

        function viderPlanning() {
            if (confirm('Vider tout le planning ?')) {
                planningHebdo = {};
                localStorage.setItem('planningHebdo', JSON.stringify(planningHebdo));
                afficherPlanning();
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            
            document.querySelectorAll('.tab').forEach(tab => {
                if (tab.getAttribute('onclick').includes(tabName)) {
                    tab.classList.add('active');
                }
            });

            if (tabName === 'suivi') {
                dessinerGraphique();
            } else if (tabName === 'planning') {
                afficherPlanning();
            }
        }

        // ==============================================
        // INITIALISATION
        // ==============================================
        
        window.addEventListener('load', function() {
            console.log('üì¶ Initialisation...');
            initialiserFirebase();
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            const data = localStorage.getItem('userData');
            if (data) {
                userData = JSON.parse(data);
                document.getElementById('nom').value = userData.nom || '';
                document.getElementById('sexe').value = userData.sexe || 'femme';
                document.getElementById('age').value = userData.age || '';
                document.getElementById('taille').value = userData.taille || '';
                document.getElementById('poids').value = userData.poids || '';
                document.getElementById('objectif').value = userData.objectif || '';
                document.getElementById('activite').value = userData.activite || '1.2';

                if (userData.imc) {
                    document.getElementById('resultatProfil').style.display = 'block';
                    document.getElementById('imcValue').textContent = userData.imc;
                    document.getElementById('poidsIdealValue').textContent = userData.poidsIdeal;
                    document.getElementById('aPerdrValue').textContent = Math.max(0, userData.poids - userData.objectif).toFixed(1);
                    document.getElementById('caloriesValue').textContent = userData.calories;
                }
            }
            
            afficherPesees();
            afficherHistoriqueRepas();
            afficherPlanning();
            
            const dateInput = document.getElementById('datePesee');
            if (dateInput) {
                dateInput.valueAsDate = new Date();
            }

            console.log('‚úÖ Application charg√©e');
        });
    </script>
</body>
</html>
